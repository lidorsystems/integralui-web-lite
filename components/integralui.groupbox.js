/*
  filename: integralui.groupbox.js
  version : 20.2.0
  Copyright Â© 2020 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web Lite" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web Lite License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/lite/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
import{c as css,h as html}from"../external/lit-element.js";import{c as classMap}from"../external/class-map.js";import{s as styleMap}from"../external/style-map.js";import{IntegralUIObjectState,IntegralUITheme}from"./integralui.enums.js";import IntegralUIBase from"./integralui.base.js";import{iuiHeaderItemDefaultStyle}from"../styles/integralui.header.style.js";import"./integralui.header.js";import{iuiGroupBoxDefaultStyle}from"../styles/integralui.groupbox.style.js";import{iuiGroupBoxOfficeStyle}from"../themes/office/integralui.groupbox.office.js";import{iuiGroupBoxMidnightStyle}from"../themes/midnight/integralui.groupbox.midnight.js";class IntegralUIGroupBox extends IntegralUIBase{_ini(){super._ini();this._cCmSty="";this._cIco="";this._cExpBTp="";this._cTxt="";this._clkPs={x:0,y:0};this._expdSt="none";this._isClk=!1;this._isExp=!1;this._isSel=!1;this._pCtr=null;this._sprsCbk=!1;this._cntHt="0";this._cntDy="block";this._cntOp=0;this._hdrSz={width:0,height:0};this._mxBlkHt=0;this._cCtrStyStt=iuiGroupBoxDefaultStyle;this._cntCSName="";this._hdrCsNm="";this._cntCS={};this._hdrBlkCs={};this._iniStyle()}connectedCallback(){}disconnectedCallback(){}_iniContent(){let e=this,t=setTimeout(function(){if(e._contentSlotElem)e._mxBlkHt=e._contentSlotElem.offsetHeight;clearTimeout(t)},100)}_iniStyle(){this._gnrCsNm="iui-groupbox";this._hdrCsNm=this._gnrCsNm+"-header";this._headerExpandBoxClassName=this._hdrCsNm+"-expand-box";this._cntCSName=this._gnrCsNm+"-content";this._dfSty={general:{disabled:this._gnrCsNm+"-disabled",focused:this._gnrCsNm+"-focused",normal:this._gnrCsNm,hovered:this._gnrCsNm+"-hovered",selected:this._gnrCsNm+"-selected"},header:{general:{disabled:this._hdrCsNm+"-disabled",focused:this._hdrCsNm+"-focused",normal:this._hdrCsNm,hovered:this._hdrCsNm+"-hovered",selected:this._hdrCsNm+"-selected"},expandBox:this._headerExpandBoxClassName},content:{general:this._cntCSName,expanded:this._cntCSName+"-expand",collapsed:this._cntCSName+"-collapse"}};this.refresh()}setParent(e){this._pCtr=e}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s)}static get properties(){return{expandBoxType:{type:String,attribute:"expandbox-type"},expanded:{type:Boolean,reflect:!0},icon:{type:String,reflect:!0},selected:{type:Boolean,reflect:!0},text:{type:String,reflect:!0}}}get expandBoxType(){return this._cExpBTp}set expandBoxType(e){if(this._cExpBTp!==e){const t=this._cExpBTp;this._cExpBTp=e;this.requestUpdate("expandBoxType",t)}}get expanded(){return this._isExp}set expanded(e){if(this._isExp!==e){const t=this._isExp;let s=this;if(s._calBfEv(e)){this._isExp=e;if(e)s._expdSt="expand";else s._expdSt="collapse";let i=setTimeout(function(){if("collapse"===s._expdSt)s._expdSt="none";clearTimeout(i)},300);s._isExp=e;s._header.animationState=s._isExp?"expand":"collapse";s._upCntCs();s._tglCnt();s.requestUpdate("expanded",t)}}}get icon(){return this._cIco}set icon(e){if(this._cIco!==e){const t=this._cIco;this._cIco=e;this.requestUpdate("icon",t)}}get selected(){return this._isSel}set selected(e){if(this._isSel!==e){let t={cancel:!1,group:this.data};this._inkEv("beforeSelect",t);if(!0!==t.cancel){const t=this._isSel;this._isSel=e;if(this._header)if(e)this._header.state|=IntegralUIObjectState.Selected;else this._header.state&=~IntegralUIObjectState.Selected;if(!this._pCtr)this._inkEv("afterSelect",{group:this.data});this._inkEv("selectedChanged",{group:this.data});this._uHdrBlkCs();this.requestUpdate("selected",t)}}}get text(){return this._cTxt}set text(e){if(this._cTxt!==e){const t=this._cTxt;this._cTxt=e;this.requestUpdate("text",t);this.refresh()}}_calBfEv(e){let t=!0;if(this._pCtr&&this._pCtr.invokeCtrlEvent)t=this._pCtr.invokeCtrlEvent(e?"BEFORE_EXPAND":"BEFORE_COLLAPSE",this);if(t){let s={cancel:!1,group:this.data};if(e)this._inkEv("beforeExpand",s);else this._inkEv("beforeCollapse",s);t=!s.cancel}return t}_calAfEv(e,t){let s={group:this.data};if(e)this._inkEv("afterExpand",s);else this._inkEv("afterCollapse",s);if(this._pCtr&&this._pCtr.invokeCtrlEvent)this._pCtr.invokeCtrlEvent(e?"AFTER_EXPAND":"AFTER_COLLAPSE",this,t);return!0}_oHdrClk(e){let t=this;if(t._enbl&&1===e.detail.buttons){if(t._pCtr&&t._pCtr.invokeCtrlMethod)t._pCtr.invokeCtrlMethod("SELECT_GROUP",t);else{t.selected=!t.selected;t.expanded=!t.expanded}t._isClk=!0;t._clkPs=t._cmnSrv.getClientPos(e,t._header);let s=setTimeout(function(){t._isClk=!1;clearTimeout(s)},500)}}collapse(){if(!this._pCtr)this.expanded=!1}expand(){this.expanded=!0}toggle(){this.expanded=!this.expanded}_tglCnt(){this._cntOp=1;if(this._pCtr&&this._pCtr.invokeCtrlMethod){if(this.expanded)this._pCtr.invokeCtrlMethod("TOGGLE_GROUPS",this);else{this._mxBlkHt=this._contentElem.offsetHeight;this._pCtr.invokeCtrlMethod("COLLAPSE_GROUP",this)}return}let e=this,t=0,s=0;if(e.expanded){e._cntDy="block";if(e.allowAnimation){let i=setInterval(function(){if(t<e._mxBlkHt){t+=s=0===s?1:s+2;e._cntHt=t+"px";e.update()}else{e._cntHt="auto";e._expdSt="none";e._calAfEv(!0);e._sprsCbk=!1;e.update();clearInterval(i)}},15)}else{e._cntHt="auto";e._expdSt="none";e._calAfEv(!0);e._sprsCbk=!1;e.update()}}else{e._mxBlkHt=e._contentElem.offsetHeight;t=e._mxBlkHt;if(e.allowAnimation){let i=setInterval(function(){if(t>0){t-=s=0===s?1:s+2;e._cntHt=t+"px";e.update()}else{e._cntDy="none";e._cntHt="0";e._expdSt="none";e._calAfEv();e._sprsCbk=!1;e.update();clearInterval(i)}},15)}else{e._cntDy="none";e._cntHt="0";e._expdSt="none";e._calAfEv();e._sprsCbk=!1;e.update()}}}getContentHeight(){return this._mxBlkHt}setContentHeight(e){this._cntHt=e;this.update()}setContentDisplay(e){this._cntDy=e;this.update()}_gCtrSty(){let e={};if(this._ctrSz.width>0)e.width=this._ctrSz.width+"px";if(this._ctrSz.height>0)e.height=this._ctrSz.height+"px";return e}_upCntCs(){this._cntCS={};this._cntCS[this._opt.currentStyle.content.general]=!0;if(!1!==this.expanded){if("expand"===this.expandState)this._cntCS[this._opt.currentStyle.content.expanded]=!0}else if("collapse"===this.expandState)this._cntCS[this._opt.currentStyle.content.collapsed]=!0}_gCntCs(){return this._cntCS}_gCntSty(e){if(this._cmnSrv.isString(e))return e;else if(e)return{general:this._cmnSrv.isFieldAvailable(e.general,this._cntCSName),expanded:this._cmnSrv.isFieldAvailable(e.expanded,this._cntCSName+"-expand"),collapsed:this._cmnSrv.isFieldAvailable(e.collapsed,this._cntCSName+"-collapse")};else return{general:this._dfSty.content.general,expanded:this._dfSty.content.expanded,collapsed:this._dfSty.content.collapsed}}_uHdrBlkCs(){this._hdrBlkCs={};this._hdrBlkCs["iui-groupbox-header-block"]=!0;if(this.selected)this._hdrBlkCs["iui-groupbox-header-marker-down"]=!0}_gHdrBlkCs(){return this._hdrBlkCs}_gHdrCs(){let e=this._hdrCsNm;if(this.state&IntegralUIObjectState.Disabled)e+=" "+this._opt.currentStyle.header.disabled;else if(this.state&IntegralUIObjectState.Focused)e+=" "+this._opt.currentStyle.header.focused;else if(this.state&IntegralUIObjectState.Selected)e+=" "+this._opt.currentStyle.header.selected;else if(this.state&IntegralUIObjectState.Hovered)e+=" "+this._opt.currentStyle.header.hovered;else e+=" "+this._opt.currentStyle.header.normal;return e}_gHdrGnSty(e){if(this._cmnSrv.isString(e))return e;else if(e)return{disabled:this._cmnSrv.isFieldAvailable(e.hovered,this._hdrCsNm+"-disabled"),focused:this._cmnSrv.isFieldAvailable(e.hovered,this._hdrCsNm+"-focused"),hovered:this._cmnSrv.isFieldAvailable(e.hovered,this._hdrCsNm+"-hovered"),normal:this._cmnSrv.isFieldAvailable(e.normal,this._hdrCsNm),selected:this._cmnSrv.isFieldAvailable(e.selected,this._hdrCsNm+"-selected")};else return{disabled:this._dfSty.header.general.disabled,focused:this._dfSty.header.general.focused,hovered:this._dfSty.header.general.hovered,normal:this._dfSty.header.general.normal,selected:this._dfSty.header.general.selected}}_gHdrSty(e){if(e)return{general:this._gHdrGnSty(e.general),expandBox:this._cmnSrv.isFieldAvailable(e.expandBox,this._headerExpandBoxClassName)};else return{general:{disabled:this._dfSty.header.general.disabled,focused:this._dfSty.header.general.focused,hovered:this._dfSty.header.general.hovered,normal:this._dfSty.header.general.normal,selected:this._dfSty.header.general.selected},expandBox:this._dfSty.header.expandBox}}_gCHdrSty(){return this._opt.currentStyle.header}setOpacity(e){this._cntOp=e;this.update()}_uSty(e){if(e)this._opt.currentStyle={general:this._gGnSty(e.general),header:this._gHdrSty(e.header),content:this._gCntSty(e.content)};else this._opt.currentStyle={general:{disabled:this._dfSty.general.disabled,focused:this._dfSty.general.focused,hovered:this._dfSty.general.hovered,normal:this._dfSty.general.normal,selected:this._dfSty.general.selected},header:{general:{disabled:this._dfSty.header.general.disabled,focused:this._dfSty.header.general.focused,hovered:this._dfSty.header.general.hovered,normal:this._dfSty.header.general.normal,selected:this._dfSty.header.general.selected},expandBox:this._dfSty.header.expandBox},content:{general:this._dfSty.content.general,expanded:this._dfSty.content.expanded,collapsed:this._dfSty.content.collapsed}}}_uThSt(e){this._cThmSettings=css``;switch(e){case IntegralUITheme.Office:this._cThmSettings.cssText=this._cmnSrv.replaceAll(iuiGroupBoxOfficeStyle.cssText,"../icons",this._cRsPt);break;case IntegralUITheme.Midnight:this._cThmSettings.cssText=this._cmnSrv.replaceAll(iuiGroupBoxMidnightStyle.cssText,"../icons",this._cRsPt);break;default:this._cThmSettings.cssText=""}}firstUpdated(e){this._uRf();this._iniContent();this.updateLayout()}refresh(){this._uSty(this.controlStyle);this._uCtrCs();this._upCntCs();this._uHdrBlkCs();this.update();this._uRf()}render(){if(this._header)this._hdrSz={width:this._header.offsetWidth,height:this._header.offsetHeight};return html`\n            <style>\n                ${this._cCtrStyStt}\n                ${iuiHeaderItemDefaultStyle}\n                ${this._cThmSettings}\n                ${this._cCmSty}\n            </style>\n            <div data-ctrl="groupbox" class=${classMap(this._gCtrCs())} style=${styleMap(this._gCtrSty())}>\n                <div class=${classMap(this._gHdrBlkCs())}>\n                    <iui-header id="group-header" .controlStyle="${this._gCHdrSty()}" .customStyle="${[this._cCtrStyStt,this._cThmSettings,this._cCmSty]}" .enabled="${this.enabled}" .icon="${this.icon}" .text="${this.text}" .animationType="${this.expandBoxType}" @mouseDown="${e=>this._oHdrClk(e)}">\n                        ${this.allowAnimation&&this._isClk?html`\n                                <span class="iui-groupbox-header-animate-select-block" style=${styleMap({height:this._hdrSz.height+"px",width:this._clkPs.x+"px"})}>\n                                    <span class=${classMap({"iui-groupbox-header-animate-select":this._isClk,"iui-groupbox-header-animate-select-left":this._isClk})} style=${styleMap({height:this._hdrSz.height+"px"})}></span>\n                                </span>\n                                <span class="iui-groupbox-header-animate-select-block" style=${styleMap({left:this._clkPs.x+"px",height:this._hdrSz.height+"px",width:this._hdrSz.width-this._clkPs.x+"px"})}>\n                                    <span class=${classMap({"iui-groupbox-header-animate-select":this._isClk,"iui-groupbox-header-animate-select-right":this._isClk})} style=${styleMap({height:this._hdrSz.height+"px"})}></span>\n                                </span>`:html``}\n                    </iui-header>\n                </div>\n                <div id="group-content" class=${classMap(this._gCntCs())} style=${styleMap({"border-width":this.expanded?"1px":"0px",display:this._cntDy,height:this._cntHt,opacity:this._cntOp})}>\n                    <slot></slot>\n                </div>\n            </div>\n        `}_uCtrStyStt(e){this._cCtrStyStt=css``;this._cCtrStyStt.cssText=this._cmnSrv.replaceAll(iuiGroupBoxDefaultStyle.cssText,"../icons",e)}_uRf(){this._contentElem=this.shadowRoot.querySelector("#group-content");this._contentSlotElem=this.shadowRoot.querySelector("slot").assignedNodes()[1];this._eRf=this.shadowRoot.querySelector("div[data-ctrl=groupbox]");this._header=this.shadowRoot.querySelector("#group-header")}}window.customElements.define("iui-groupbox",IntegralUIGroupBox);export default IntegralUIGroupBox;